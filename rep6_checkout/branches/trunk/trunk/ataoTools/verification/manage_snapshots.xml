<?xml version="1.0"?>
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
<!-
<!-   Upgrade automation script
<!-
<!-
<!- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
<!-
<!-    Copyright:    
<!-      Company:    Kronos
<!-      Author:    jeffrey.keil
<!-      Updated:   1\4\2011 jeffrey.keil
<!-
<!- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

<project name="restore.vm.project" basedir=".">
	<property environment="env" />

	<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  -->
	<!--   This script uses a property file that is generated by getLocalUpgradeProperties.pl -->
	<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  -->
	
	<property file="antBomUpgradeLocal.properties" />
	<property file="file.properties" />
	<property name="base.vm.name" value="VMImage_8.7SR_" />
	<property name="new.sr.number" value=""/>
	<property name="old.sr.number" value=""/>
	<property name="new.vm.name" value="${base.vm.name}${new.sr.number}" />
	<property name="old.vm.name" value="${base.vm.name}${old.sr.number}" />
  <property name="BOM.local.dir" value="."/>
	<property name="propfile.exists" value="false"/>
	<property name="vm.server.ip" value="10.130.10.138" />
	<property name="vm.server.name" value="LinuxBuildMachineVM"/>
		
  <target name="create.vm.snapshot">
    <antcall target="run.primary.create"/>
    <antcall target="run.primary.powerup"/>
  </target>
  
  <target name="remove.vm.snapshot">
    <antcall target="run.primary.restore"/>
    <antcall target="run.primary.powerup"/>
  </target>
   
  <target name="create.vm.snapshot.test">
    <echo message="===> Creating new SR VM : ${new.vm.name}." />
    <echo message="===> Turning on SR VM : ${vm.server.name}." />
  </target>
  
  <target name="remove.vm.snapshot.test">
    <echo message="===> Restore to old SR VM : ${old.vm.name}." />
    <echo message="===> Turning on old SR VM : ${vm.server.name}." />
  </target>
  
   <target name="run.primary.create">
    <echo message="===> Creating new SR VM : ${new.vm.name}." />
    <exec executable="perl">
        <arg value="snapshotmanager.pl"/>
        <arg value="--server"/>
        <arg value="${vm.server.ip}"/>
        <arg value="--vmname"/>
        <arg value="${vm.server.name}"/>
        <arg value="--snapshotname"/>
        <arg value="${new.vm.name}"/>
        <arg value="-username"/>
        <arg value="root"/>
        <arg value="--password"/>
        <arg value="Passw0rd"/>
        <arg value="--operation"/>
        <arg value="create"/>
    </exec>
    <echo message="===> New SR VM ${new.vm.name} has been created." />
   </target>
    
   <target name="run.primary.restore">
    <echo message="===> Restore to old SR VM : ${old.vm.name}." />
    <exec executable="perl">
        <arg value="snapshotmanager.pl"/>
        <arg value="--server"/>
        <arg value="${vm.server.ip}"/>
        <arg value="--vmname"/>
        <arg value="${vm.server.name}"/>
        <arg value="--snapshotname"/>
        <arg value="${old.vm.name}"/>
        <arg value="-username"/>
        <arg value="root"/>
        <arg value="--password"/>
        <arg value="Passw0rd"/>
        <arg value="--operation"/>
        <arg value="goto"/>
    </exec>
    <echo message="===> Restore SR VM ${old.vm.name} has been restored." />
   </target>
   
   <target name="run.primary.remove">
    <echo message="===> Removing existing SR VM : ${new.vm.name}." />
    <exec executable="perl">
        <arg value="snapshotmanager.pl"/>
        <arg value="--server"/>
        <arg value="${vm.server.ip}"/>
        <arg value="--vmname"/>
        <arg value="${vm.server.name}"/>
        <arg value="--snapshotname"/>
        <arg value="--children"/>
        <arg value="0"/>
        <arg value="${new.vm.name}"/>
        <arg value="-username"/>
        <arg value="root"/>
        <arg value="--password"/>
        <arg value="Passw0rd"/>
        <arg value="--operation"/>
        <arg value="remove"/>
    </exec>
    <echo message="===> New SR VM ${new.vm.name} has been removed." />
   </target>
   
   <target name="run.primary.powerup">
    <echo message="===> Turning on SR VM : ${vm.server.name}." />
    <exec executable="perl">
        <arg value="vmcontrol.pl"/>
        <arg value="--server"/>
        <arg value="${vm.server.ip}"/>
        <arg value="--vmname"/>
        <arg value="${vm.server.name}"/>
        <arg value="-username"/>
        <arg value="root"/>
        <arg value="--password"/>
        <arg value="Passw0rd"/>
        <arg value="--operation"/>
        <arg value="poweron"/>
    </exec>
    <echo message="===> New SR VM ${new.vm.name} has been powered up." />
   </target>
    
  </project>


